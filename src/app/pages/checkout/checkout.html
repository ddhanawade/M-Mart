<div class="checkout-page">
  <!-- Professional Page Header -->
  <div class="page-header">
    <div class="container">
      <div class="header-content">
        <div class="breadcrumb">
          <a routerLink="/">Home</a>
          <span class="separator">></span>
          <a routerLink="/cart">Cart</a>
          <span class="separator">></span>
          <span class="current">Checkout</span>
        </div>
        <h1 class="page-title">Secure Checkout</h1>
        
        <!-- Professional Progress Steps -->
        <div class="progress-steps">
          <div class="step" [class.active]="currentStep === 'address'" [class.completed]="currentStep !== 'address' && currentStep !== 'payment'">
            <div class="step-icon">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z" fill="currentColor"/>
              </svg>
            </div>
            <span>Address</span>
          </div>
          <div class="step" [class.active]="currentStep === 'payment'" [class.completed]="currentStep === 'processing' || currentStep === 'success' || currentStep === 'failed'">
            <div class="step-icon">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M20 4H4c-1.11 0-1.99.89-1.99 2L2 18c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V6c0-1.11-.89-2-2-2zm0 14H4v-6h16v6zm0-10H4V6h16v2z" fill="currentColor"/>
              </svg>
            </div>
            <span>Payment</span>
          </div>
          <div class="step" [class.active]="currentStep === 'processing' || currentStep === 'success' || currentStep === 'failed'">
            <div class="step-icon">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z" fill="currentColor"/>
              </svg>
            </div>
            <span>Confirmation</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Checkout Content -->
  <div class="checkout-content">
    <div class="container">
      
      <!-- Professional Login Required Section -->
      <div class="login-required" *ngIf="!user">
        <div class="login-required-content">
          <div class="login-icon">
            <svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zM12 17c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zM15.1 8H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z" fill="currentColor"/>
            </svg>
          </div>
          <h2>Login Required</h2>
          <p>Please login to your account to proceed with secure checkout</p>
          <div class="login-actions">
            <a routerLink="/auth" class="btn btn-primary">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M12.65 10C11.83 7.67 9.61 6 7 6c-3.31 0-6 2.69-6 6s2.69 6 6 6c2.61 0 4.83-1.67 5.65-4H17v4h4v-4h2v-4H12.65zM7 14c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2z" fill="currentColor"/>
              </svg>
              Login to Continue
            </a>
            <a routerLink="/cart" class="btn btn-outline">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M7 18c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12L8.1 13h7.45c.75 0 1.41-.41 1.75-1.03L21.7 4H5.21l-.94-2H1zm16 16c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z" fill="currentColor"/>
              </svg>
              Back to Cart
            </a>
          </div>
        </div>
      </div>

      <!-- Professional Checkout Flow -->
      <div class="checkout-main" *ngIf="user">
        
        <!-- STEP 1: Professional Address Selection -->
        <div class="checkout-section" *ngIf="currentStep === 'address'">
          <div class="section-content">
            <h2 class="section-title">Select Delivery Address</h2>
            
            <div class="address-list" *ngIf="hasAddresses()">
              <div class="address-card" 
                   *ngFor="let address of getUserAddresses()"
                   [class.selected]="address?.id === selectedAddressId"
                   (click)="selectedAddressId = address?.id || ''">
                <div class="address-header">
                  <div class="address-type">
                    <span class="type-icon">
                      <svg *ngIf="address?.type === 'home'" width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z" fill="currentColor"/>
                      </svg>
                      <svg *ngIf="address?.type === 'work'" width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M20 6h-2.18c.11-.31.18-.65.18-1a2.996 2.996 0 0 0-5.5-1.65l-.5.67-.5-.68C10.96 2.54 10.05 2 9 2 7.34 2 6 3.34 6 5c0 .35.07.69.18 1H4c-1.11 0-2 .89-2 2v11c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-5-2c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM9 4c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1z" fill="currentColor"/>
                      </svg>
                      <svg *ngIf="address?.type !== 'home' && address?.type !== 'work'" width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z" fill="currentColor"/>
                      </svg>
                    </span>
                    <span class="type-name">{{address?.type | titlecase}}</span>
                    <span class="default-badge" *ngIf="address?.isDefault">Default</span>
                  </div>
                  <div class="radio-indicator">
                    <div class="radio-dot" [class.selected]="address?.id === selectedAddressId"></div>
                  </div>
                </div>
                <div class="address-details">
                  <div class="address-name">{{address?.name}}</div>
                  <div class="address-text">
                    {{address?.street}}, {{address?.city}}, {{address?.state}} - {{address?.pincode}}
                  </div>
                  <div class="address-landmark" *ngIf="address?.landmark">
                    Near {{address?.landmark}}
                  </div>
                </div>
              </div>
            </div>

            <div class="no-address" *ngIf="!hasAddresses()">
              <div class="no-address-content">
                <div class="no-address-icon">
                  <svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z" fill="currentColor"/>
                  </svg>
                </div>
                <h3>No saved addresses</h3>
                <p>Please add a delivery address to continue with your order</p>
              </div>
            </div>

            <div class="section-actions">
              <button class="btn btn-outline" (click)="backToCart()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M7 18c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12L8.1 13h7.45c.75 0 1.41-.41 1.75-1.03L21.7 4H5.21l-.94-2H1zm16 16c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z" fill="currentColor"/>
                </svg>
                Back to Cart
              </button>
              <button class="btn btn-primary" 
                      [disabled]="!selectedAddressId"
                      (click)="proceedToPayment()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M20 4H4c-1.11 0-1.99.89-1.99 2L2 18c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V6c0-1.11-.89-2-2-2zm0 14H4v-6h16v6zm0-10H4V6h16v2z" fill="currentColor"/>
                </svg>
                Proceed to Payment
              </button>
            </div>
          </div>
        </div>

        <!-- STEP 2: Professional Payment Selection -->
        <div class="checkout-section" *ngIf="currentStep === 'payment'">
          <div class="section-content">
            <h2 class="section-title">Select Payment Method</h2>
            
            <div class="payment-methods">
              <div class="payment-option"
                   *ngFor="let option of paymentOptions"
                   [class.selected]="option.id === selectedPaymentMethod"
                   (click)="selectPaymentMethod(option.id)">
                <div class="option-header">
                  <div class="option-info">
                    <span class="option-icon">
                      <svg *ngIf="option.id === 'card'" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M20 4H4c-1.11 0-1.99.89-1.99 2L2 18c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V6c0-1.11-.89-2-2-2zm0 14H4v-6h16v6zm0-10H4V6h16v2z" fill="currentColor"/>
                      </svg>
                      <svg *ngIf="option.id === 'upi'" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M7 2v11h3v9l7-12h-4l4-8z" fill="currentColor"/>
                      </svg>
                      <svg *ngIf="option.id === 'cod'" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M11.8 10.9c-2.27-.59-3-1.2-3-2.15 0-1.09 1.01-1.85 2.7-1.85 1.78 0 2.44.85 2.5 2.1h2.21c-.07-1.72-1.12-3.3-3.21-3.81V3h-3v2.16c-1.94.42-3.5 1.68-3.5 3.61 0 2.31 1.91 3.46 4.7 4.13 2.5.6 3 1.48 3 2.41 0 .69-.49 1.79-2.7 1.79-2.06 0-2.87-.92-2.98-2.1h-2.2c.12 2.19 1.76 3.42 3.68 3.83V21h3v-2.15c1.95-.37 3.5-1.5 3.5-3.55 0-2.84-2.43-3.81-4.7-4.4z" fill="currentColor"/>
                      </svg>
                      <svg *ngIf="option.id === 'wallet'" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M21 18v1c0 1.1-.9 2-2 2H5c-1.11 0-2-.9-2-2V5c0-1.1.89-2 2-2h14c1.1 0 2 .9 2 2v1h-9c-1.11 0-2 .9-2 2v8c0 1.1.89 2 2 2h9zm-9-2h10V8H12v8zm4-2.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5z" fill="currentColor"/>
                      </svg>
                    </span>
                    <div class="option-details">
                      <div class="option-name">{{option.name}}</div>
                      <div class="option-description">{{option.description}}</div>
                    </div>
                  </div>
                  <div class="radio-indicator">
                    <div class="radio-dot" [class.selected]="option.id === selectedPaymentMethod"></div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Professional Card Payment Form -->
            <div class="payment-form" *ngIf="isCardPayment()">
              <h3>
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M20 4H4c-1.11 0-1.99.89-1.99 2L2 18c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V6c0-1.11-.89-2-2-2zm0 14H4v-6h16v6zm0-10H4V6h16v2z" fill="currentColor"/>
                </svg>
                Card Details
              </h3>
              <div class="form-grid">
                <div class="form-group full-width">
                  <label>Card Number</label>
                  <input type="text" 
                         placeholder="1234 5678 9012 3456"
                         [(ngModel)]="cardDetails.number"
                         maxlength="19"
                         class="form-control">
                </div>
                <div class="form-group">
                  <label>Expiry Month</label>
                  <select [(ngModel)]="cardDetails.expiryMonth" class="form-control">
                    <option value="">MM</option>
                    <option value="01">01</option>
                    <option value="02">02</option>
                    <option value="03">03</option>
                    <option value="04">04</option>
                    <option value="05">05</option>
                    <option value="06">06</option>
                    <option value="07">07</option>
                    <option value="08">08</option>
                    <option value="09">09</option>
                    <option value="10">10</option>
                    <option value="11">11</option>
                    <option value="12">12</option>
                  </select>
                </div>
                <div class="form-group">
                  <label>Expiry Year</label>
                  <select [(ngModel)]="cardDetails.expiryYear" class="form-control">
                    <option value="">YYYY</option>
                    <option value="2024">2024</option>
                    <option value="2025">2025</option>
                    <option value="2026">2026</option>
                    <option value="2027">2027</option>
                    <option value="2028">2028</option>
                    <option value="2029">2029</option>
                  </select>
                </div>
                <div class="form-group">
                  <label>CVV</label>
                  <input type="text" 
                         placeholder="123"
                         [(ngModel)]="cardDetails.cvv"
                         maxlength="4"
                         class="form-control">
                </div>
                <div class="form-group full-width">
                  <label>Cardholder Name</label>
                  <input type="text" 
                         placeholder="Full name as on card"
                         [(ngModel)]="cardDetails.holderName"
                         class="form-control">
                </div>
              </div>
            </div>

            <!-- Professional UPI Payment Form -->
            <div class="payment-form" *ngIf="isUpiPayment()">
              <h3>
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M7 2v11h3v9l7-12h-4l4-8z" fill="currentColor"/>
                </svg>
                UPI Payment
              </h3>
              <div class="form-group">
                <label>UPI ID</label>
                <input type="text" 
                       placeholder="yourname@paytm"
                       [(ngModel)]="upiId"
                       class="form-control">
              </div>
            </div>

            <!-- Professional COD Info -->
            <div class="payment-info" *ngIf="isCodPayment()">
              <div class="info-card">
                <div class="info-icon">
                  <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M11.8 10.9c-2.27-.59-3-1.2-3-2.15 0-1.09 1.01-1.85 2.7-1.85 1.78 0 2.44.85 2.5 2.1h2.21c-.07-1.72-1.12-3.3-3.21-3.81V3h-3v2.16c-1.94.42-3.5 1.68-3.5 3.61 0 2.31 1.91 3.46 4.7 4.13 2.5.6 3 1.48 3 2.41 0 .69-.49 1.79-2.7 1.79-2.06 0-2.87-.92-2.98-2.1h-2.2c.12 2.19 1.76 3.42 3.68 3.83V21h3v-2.15c1.95-.37 3.5-1.5 3.5-3.55 0-2.84-2.43-3.81-4.7-4.4z" fill="currentColor"/>
                  </svg>
                </div>
                <div class="info-content">
                  <h4>Cash on Delivery</h4>
                  <p>Pay ₹{{getTotalWithDelivery()}} when your fresh organic order is delivered to your doorstep.</p>
                  <ul>
                    <li>
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z" fill="currentColor"/>
                      </svg>
                      No online payment required
                    </li>
                    <li>
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z" fill="currentColor"/>
                      </svg>
                      Pay after receiving your order
                    </li>
                    <li>
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z" fill="currentColor"/>
                      </svg>
                      Check products before payment
                    </li>
                    <li>
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z" fill="currentColor"/>
                      </svg>
                      100% secure and convenient
                    </li>
                  </ul>
                </div>
              </div>
            </div>

            <div class="section-actions">
              <button class="btn btn-outline" (click)="backToAddress()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z" fill="currentColor"/>
                </svg>
                Back to Address
              </button>
              <button class="btn btn-primary" 
                      [disabled]="!selectedPaymentMethod || !isFormValid()"
                      (click)="processPayment()">
                <svg *ngIf="isCodPayment()" width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M7.58 4.08L6.15 2.65C3.75 4.48 2.17 7.3 2.03 10.5h2c.15-2.65 1.51-4.97 3.55-6.42zm12.39 6.42h2c-.15-3.2-1.73-6.02-4.12-7.85l-1.42 1.43c2.02 1.45 3.39 3.77 3.54 6.42zM18 11c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2v-5z" fill="currentColor"/>
                </svg>
                <svg *ngIf="!isCodPayment()" width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M20 4H4c-1.11 0-1.99.89-1.99 2L2 18c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V6c0-1.11-.89-2-2-2zm0 14H4v-6h16v6zm0-10H4V6h16v2z" fill="currentColor"/>
                </svg>
                {{isCodPayment() ? 'Place Order' : 'Pay ₹' + getTotalWithDelivery()}}
              </button>
            </div>
          </div>
        </div>

        <!-- STEP 3: Professional Processing -->
        <div class="checkout-section" *ngIf="currentStep === 'processing'">
          <div class="section-content">
            <div class="processing-state">
              <div class="processing-animation">
                <div class="spinner"></div>
              </div>
              <h2>Processing Your {{isCodPayment() ? 'Order' : 'Payment'}}...</h2>
              <p>Please don't close this window or press the back button. We're securing your transaction.</p>
              <div class="processing-steps">
                <div class="processing-step">
                  <span class="step-icon">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zM12 17c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zM15.1 8H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z" fill="currentColor"/>
                    </svg>
                  </span>
                  <span>Securing your transaction</span>
                </div>
                <div class="processing-step">
                  <span class="step-icon">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M20 4H4c-1.11 0-1.99.89-1.99 2L2 18c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V6c0-1.11-.89-2-2-2zm0 14H4v-6h16v6zm0-10H4V6h16v2z" fill="currentColor"/>
                    </svg>
                  </span>
                  <span>{{isCodPayment() ? 'Confirming your order' : 'Processing payment'}}</span>
                </div>
                <div class="processing-step">
                  <span class="step-icon">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M7.58 4.08L6.15 2.65C3.75 4.48 2.17 7.3 2.03 10.5h2c.15-2.65 1.51-4.97 3.55-6.42zm12.39 6.42h2c-.15-3.2-1.73-6.02-4.12-7.85l-1.42 1.43c2.02 1.45 3.39 3.77 3.54 6.42zM18 11c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2v-5z" fill="currentColor"/>
                    </svg>
                  </span>
                  <span>Preparing for dispatch</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- STEP 4: Professional Success -->
        <div class="checkout-section" *ngIf="currentStep === 'success'">
          <div class="section-content">
            <div class="success-state">
              <div class="success-animation">
                <div class="success-icon">
                  <svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z" fill="currentColor"/>
                  </svg>
                </div>
              </div>
              <h2>{{isCodPayment() ? 'Order Placed Successfully!' : 'Payment Successful!'}}</h2>
              <p>Thank you for choosing Mahabaleshwer Mart! We're preparing your fresh organic order for delivery.</p>
              
              <div class="transaction-details" *ngIf="transactionResult">
                <div class="detail-card">
                  <div class="detail-row">
                    <span>Transaction ID:</span>
                    <span class="transaction-id">{{transactionResult.transactionId}}</span>
                  </div>
                  <div class="detail-row">
                    <span>Amount:</span>
                    <span class="amount">₹{{getTotalWithDelivery()}}</span>
                  </div>
                  <div class="detail-row">
                    <span>Payment Method:</span>
                    <span>{{getSelectedPaymentOption()?.name}}</span>
                  </div>
                  <div class="detail-row">
                    <span>Delivery Address:</span>
                    <span>{{getSelectedAddress()?.name}}</span>
                  </div>
                </div>
              </div>

              <div class="success-actions">
                <button class="btn btn-primary" (click)="goToOrders()">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm2 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z" fill="currentColor"/>
                  </svg>
                  View Orders
                </button>
                <button class="btn btn-outline" (click)="continueShopping()">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M7 18c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12L8.1 13h7.45c.75 0 1.41-.41 1.75-1.03L21.7 4H5.21l-.94-2H1zm16 16c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z" fill="currentColor"/>
                  </svg>
                  Continue Shopping
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- STEP 5: Professional Failed -->
        <div class="checkout-section" *ngIf="currentStep === 'failed'">
          <div class="section-content">
            <div class="failed-state">
              <div class="failed-animation">
                <div class="failed-icon">
                  <svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" fill="currentColor"/>
                  </svg>
                </div>
              </div>
              <h2>Payment Failed</h2>
              <p>We encountered an issue processing your payment. Please try again with a different method.</p>
              
              <div class="error-details" *ngIf="transactionResult">
                <div class="error-card">
                  <div class="error-message">
                    <strong>Error:</strong> {{transactionResult.errorMessage}}
                  </div>
                  <div class="error-code">
                    <strong>Error Code:</strong> {{transactionResult.errorCode}}
                  </div>
                </div>
              </div>

              <div class="failed-actions">
                <button class="btn btn-primary" (click)="retryPayment()">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z" fill="currentColor"/>
                  </svg>
                  Retry Payment
                </button>
                <button class="btn btn-outline" (click)="cancelTransaction()">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M20 4H4c-1.11 0-1.99.89-1.99 2L2 18c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V6c0-1.11-.89-2-2-2zm0 14H4v-6h16v6zm0-10H4V6h16v2z" fill="currentColor"/>
                  </svg>
                  Try Different Method
                </button>
                <button class="btn btn-secondary" (click)="backToCart()">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M7 18c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12L8.1 13h7.45c.75 0 1.41-.41 1.75-1.03L21.7 4H5.21l-.94-2H1zm16 16c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z" fill="currentColor"/>
                  </svg>
                  Back to Cart
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Professional Order Summary Sidebar -->
        <div class="order-summary-sidebar" *ngIf="currentStep === 'address' || currentStep === 'payment'">
          <div class="summary-card">
            <h3 class="summary-title">Order Summary</h3>
            
            <div class="summary-items">
              <div class="summary-item" *ngFor="let item of cartItems">
                <div class="item-info">
                  <ng-container *ngIf="item.product.image && item.product.image.startsWith('http'); else emojiThumb">
                    <img class="item-thumb" [src]="item.product.image" [alt]="item.product.name" loading="lazy" decoding="async" />
                  </ng-container>
                  <ng-template #emojiThumb>
                    <span class="item-emoji">{{item.product.image}}</span>
                  </ng-template>
                  <div class="item-details">
                    <div class="item-name">{{item.product.name}}</div>
                    <div class="item-quantity">Qty: {{item.selectedQuantity}} {{item.product.unit}}</div>
                  </div>
                </div>
                <div class="item-price">₹{{item.totalPrice}}</div>
              </div>
            </div>

            <div class="summary-calculations">
              <div class="calc-row">
                <span>Subtotal</span>
                <span>₹{{totalAmount}}</span>
              </div>
              <div class="calc-row">
                <span>Delivery</span>
                <span [class.free]="getDeliveryCharge() === 0">
                  {{getDeliveryCharge() === 0 ? 'FREE' : '₹' + getDeliveryCharge()}}
                </span>
              </div>
              <div class="calc-row total">
                <span>Total</span>
                <span>₹{{getTotalWithDelivery()}}</span>
              </div>
            </div>

            <div class="delivery-info" *ngIf="getSelectedAddress()">
              <h4>
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M20 8h-3V4H3c-1.1 0-2 .9-2 2v11h2c0 1.66 1.34 3 3 3s3-1.34 3-3h6c0 1.66 1.34 3 3 3s3-1.34 3-3h2v-5l-3-4zM6 18.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zm13.5-9l1.96 2.5H17V9.5h2.5zm-1.5 9c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5z" fill="currentColor"/>
                </svg>
                Delivery Address
              </h4>
              <div class="address-preview">
                <div class="address-name">{{getSelectedAddress()?.name}}</div>
                <div class="address-text">
                  {{getSelectedAddress()?.street}}, {{getSelectedAddress()?.city}}
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
