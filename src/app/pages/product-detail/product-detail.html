<div class="product-detail-page">
  <!-- Loading State -->
  <div class="loading-overlay" *ngIf="isLoading">
    <div class="loading-spinner"></div>
    <p>Loading product details...</p>
  </div>

  <!-- Product Not Found -->
  <div class="product-not-found" *ngIf="!isLoading && !product">
    <div class="container">
      <div class="not-found-content">
        <div class="not-found-icon">
          <img src="assets/images/icons/package.svg" alt="Product not found" class="not-found-svg">
        </div>
        <h2>Product Not Found</h2>
        <p>The product you're looking for doesn't exist or has been removed.</p>
        <button class="btn btn-primary" (click)="goBack()">
          <img src="assets/images/icons/arrow-left.svg" alt="Back" class="btn-icon">
          Go Back
        </button>
      </div>
    </div>
  </div>

  <!-- Product Details -->
  <div class="product-content" *ngIf="!isLoading && product">
    
    <!-- Breadcrumb Navigation -->
    <div class="breadcrumb-section">
      <div class="container">
        <div class="breadcrumb">
          <a routerLink="/" class="breadcrumb-item">
            <img src="assets/images/icons/home.svg" alt="Home" class="breadcrumb-icon">
            Home
          </a>
          <img src="assets/images/icons/chevron-right.svg" alt=">" class="separator">
          <a routerLink="/products" class="breadcrumb-item">
            <img src="assets/images/icons/package.svg" alt="Products" class="breadcrumb-icon">
            Products
          </a>
          <img src="assets/images/icons/chevron-right.svg" alt=">" class="separator">
          <a [routerLink]="['/products', product.category]" class="breadcrumb-item">
            <img [src]="getCategoryIcon()" [alt]="getCategoryDisplayName()" class="breadcrumb-icon">
            {{getCategoryDisplayName()}}
          </a>
          <img src="assets/images/icons/chevron-right.svg" alt=">" class="separator">
          <span class="current">{{product.name}}</span>
        </div>
        <button class="back-btn" (click)="goBack()">
          <img src="assets/images/icons/arrow-left.svg" alt="Back" class="back-icon">
          <span class="back-text">Back</span>
        </button>
        <div class="manage-actions">
          <a class="btn btn-outline" (click)="editProduct()">
            Edit
          </a>
          <button class="btn btn-danger" (click)="deleteProduct()" [disabled]="isDeleting">
            {{ isDeleting ? 'Deleting...' : 'Delete' }}
          </button>
        </div>
      </div>
    </div>

    <!-- Main Product Section -->
    <div class="product-main">
      <div class="container">
        <div class="product-layout">
          
          <!-- Product Images -->
          <div class="product-images">
            <div class="main-image">
              <div class="image-container" (click)="openLightbox()" role="button" aria-label="View larger image">
                <ng-container *ngIf="selectedImage && selectedImage.startsWith('http'); else textMainImg">
                  <img class="product-main-img" [src]="selectedImage" [alt]="product.name" />
                </ng-container>
                <ng-template #textMainImg>
                  <span class="product-emoji">{{selectedImage}}</span>
                </ng-template>
                
                <!-- Product Badges -->
                <div class="product-badges">
                  <span class="badge organic-badge" *ngIf="product.organic">Organic</span>
                  <span class="badge fresh-badge" *ngIf="product.fresh">Fresh</span>
                  <span class="badge discount-badge" *ngIf="product.originalPrice">
                    {{getDiscountPercentage()}}% OFF
                  </span>
                </div>
              </div>
            </div>
            
            <!-- Image Thumbnails (if multiple images available) -->
            <div class="image-thumbnails" *ngIf="product.images && product.images.length > 1">
              <button 
                *ngFor="let image of product.images" 
                class="thumbnail-btn"
                [class.active]="selectedImage === image"
                (click)="selectImage(image)">
                <ng-container *ngIf="image && image.startsWith('http'); else textThumb">
                  <img class="thumbnail-img" [src]="image" [alt]="product.name" />
                </ng-container>
                <ng-template #textThumb>
                  <span class="thumbnail-emoji">{{image}}</span>
                </ng-template>
              </button>
            </div>
          </div>

          <!-- Product Information -->
          <div class="product-info">
            
            <!-- Product Header -->
            <div class="product-header">
              <div class="category-tag">{{getCategoryDisplayName()}}</div>
              <h1 class="product-title">{{product.name}}</h1>
              <p class="product-description">{{product.description}}</p>
              
              <!-- Rating & Reviews -->
              <div class="rating-section">
                <div class="stars">
                  <img *ngFor="let star of getStars()" 
                       [src]="star ? 'assets/images/icons/star-filled.svg' : 'assets/images/icons/star.svg'" 
                       [alt]="star ? 'Filled star' : 'Empty star'" 
                       class="star">
                </div>
                <span class="rating-text">{{product.rating}}</span>
                <span class="review-count">({{product.reviewCount}} reviews)</span>
              </div>

              <div class="utility-row">
                <button class="btn small" (click)="toggleWishlist()">
                  <img src="assets/images/icons/star.svg" alt="Wishlist" class="btn-icon">
                  <span>{{ isInWishlist ? 'Remove from Wishlist' : 'Add to Wishlist' }}</span>
                </button>
                <a class="btn small" [href]="getShareUrl()" target="_blank" rel="noopener">Share</a>
                <a class="btn small" routerLink="/wishlist">Wishlist</a>
              </div>
            </div>

            <!-- Price Section -->
            <div class="price-section">
              <div class="price-main">
                <span class="current-price">₹{{product.price}}</span>
                <span class="original-price" *ngIf="product.originalPrice">₹{{product.originalPrice}}</span>
                <span class="unit-text">/ {{product.unit}}</span>
              </div>
              <div class="savings" *ngIf="product.originalPrice">
                You save ₹{{product.originalPrice - product.price}} ({{getDiscountPercentage()}}%)
              </div>
              <div class="delivery-row">
                <div class="eta">
                  <img src="assets/images/icons/truck.svg" alt="Delivery" class="eta-icon">
                  Delivery: <strong>{{ getEstimatedDelivery() }}</strong>
                </div>
                <div class="origin">
                  Origin: <strong>{{ getOriginCountry() }}</strong>
                </div>
              </div>
            </div>

            <!-- Stock & Availability -->
            <div class="availability-section">
              <div class="stock-status" [class.in-stock]="product.inStock" [class.out-of-stock]="!product.inStock">
                <img [src]="product.inStock ? 'assets/images/icons/check-circle.svg' : 'assets/images/icons/x-circle.svg'" 
                     [alt]="product.inStock ? 'In Stock' : 'Out of Stock'" 
                     class="status-icon">
                <span class="status-text">{{product.inStock ? 'In Stock' : 'Out of Stock'}}</span>
              </div>
              <div class="quantity-info" *ngIf="product.inStock && product.quantity <= 10">
                <img src="assets/images/icons/alert-triangle.svg" alt="Warning" class="warning-icon">
                <span class="warning-text">Only {{product.quantity}} left in stock!</span>
              </div>
            </div>

            <!-- Quantity Selector & Actions -->
            <div class="purchase-section">
              <div class="quantity-selector">
                <label class="quantity-label">Quantity:</label>
                <div class="quantity-controls">
                  <button class="qty-btn minus" (click)="decreaseQuantity()" [disabled]="quantity <= 1">−</button>
                  <span class="quantity-display">{{quantity}}</span>
                  <button class="qty-btn plus" (click)="increaseQuantity()" [disabled]="!product.inStock || quantity >= product.quantity">+</button>
                </div>
              </div>

              <!-- Action Buttons -->
              <div class="action-buttons">
                <a class="btn btn-secondary" routerLink="/wishlist">Go to Wishlist</a>
                <button 
                  class="btn btn-primary add-to-cart-btn"
                  (click)="addToCart()"
                  [disabled]="!product.inStock || isAddingToCart">
                  <img src="assets/images/icons/shopping-cart.svg" alt="Add to Cart" class="btn-icon" *ngIf="!isAddingToCart">
                  <div class="loading-spinner" *ngIf="isAddingToCart"></div>
                  <span class="btn-text">{{isAddingToCart ? 'Adding...' : 'Add to Cart'}}</span>
                </button>
                
                <button 
                  class="btn btn-secondary buy-now-btn"
                  (click)="buyNow()"
                  [disabled]="!product.inStock">
                  <img src="assets/images/icons/zap.svg" alt="Buy Now" class="btn-icon">
                  <span class="btn-text">Buy Now</span>
                </button>
              </div>
            </div>

            <!-- Product Features -->
            <div class="features-section">
              <h3 class="features-title">Product Features</h3>
              <div class="features-grid">
                <div class="feature-item" *ngIf="product.organic">
                  <img src="assets/images/icons/leaf.svg" alt="Organic" class="feature-icon">
                  <span class="feature-text">100% Organic</span>
                </div>
                <div class="feature-item" *ngIf="product.fresh">
                  <img src="assets/images/icons/sparkles.svg" alt="Fresh" class="feature-icon">
                  <span class="feature-text">Farm Fresh</span>
                </div>
                <div class="feature-item">
                  <img src="assets/images/icons/truck.svg" alt="Delivery" class="feature-icon">
                  <span class="feature-text">Free Delivery</span>
                </div>
                <div class="feature-item">
                  <img src="assets/images/icons/refresh-cw.svg" alt="Returns" class="feature-icon">
                  <span class="feature-text">Easy Returns</span>
                </div>
              </div>
            </div>

            <!-- Trust & Seller Info -->
            <div class="trust-seller">
              <div class="trust-badges">
                <div class="badge-item">
                  <img src="assets/images/icons/check-circle.svg" class="badge-icon" alt="Quality">
                  <div class="badge-text">
                    <strong>Premium Quality</strong>
                    <span>Carefully sourced & inspected</span>
                  </div>
                </div>
                <div class="badge-item">
                  <img src="assets/images/icons/refresh-cw.svg" class="badge-icon" alt="Returns">
                  <div class="badge-text">
                    <strong>Easy Returns</strong>
                    <span>7-day return policy</span>
                  </div>
                </div>
                <div class="badge-item">
                  <img src="assets/images/icons/truck.svg" class="badge-icon" alt="Delivery">
                  <div class="badge-text">
                    <strong>Fast Delivery</strong>
                    <span>Reliable, on-time delivery</span>
                  </div>
                </div>
              </div>
              <div class="seller-card">
                <div class="seller-row">
                  <div>
                    <div class="seller-label">Sold by</div>
                    <div class="seller-name">{{ getSupplierName() }}</div>
                  </div>
                  <a class="seller-link" routerLink="/products">View more</a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Product Details Tabs -->
    <div class="product-tabs">
      <div class="container">
        <div class="tabs-section">
          
          <!-- Nutritional Information -->
          <div class="tab-content nutrition-tab" *ngIf="product.nutritionalInfo">
            <h3 class="tab-title">Nutritional Information</h3>
            <div class="nutrition-grid">
              <div class="nutrition-item">
                <span class="nutrition-label">Calories</span>
                <span class="nutrition-value">{{product.nutritionalInfo.calories}} kcal</span>
              </div>
              <div class="nutrition-item">
                <span class="nutrition-label">Protein</span>
                <span class="nutrition-value">{{product.nutritionalInfo.protein}}g</span>
              </div>
              <div class="nutrition-item">
                <span class="nutrition-label">Carbs</span>
                <span class="nutrition-value">{{product.nutritionalInfo.carbs}}g</span>
              </div>
              <div class="nutrition-item">
                <span class="nutrition-label">Fat</span>
                <span class="nutrition-value">{{product.nutritionalInfo.fat}}g</span>
              </div>
              <div class="nutrition-item">
                <span class="nutrition-label">Fiber</span>
                <span class="nutrition-value">{{product.nutritionalInfo.fiber}}g</span>
              </div>
            </div>
            
            <!-- Vitamins -->
            <div class="vitamins-section" *ngIf="product.nutritionalInfo.vitamins?.length">
              <h4 class="vitamins-title">Rich in Vitamins</h4>
              <div class="vitamins-list">
                <span class="vitamin-tag" *ngFor="let vitamin of product.nutritionalInfo.vitamins">{{vitamin}}</span>
              </div>
            </div>
          </div>

          <!-- Product Description -->
          <div class="tab-content description-tab">
            <h3 class="tab-title">Product Description</h3>
            <div class="description-content">
              <p>{{product.description}}</p>
              <div class="product-highlights">
                <h4>Why Choose This Product?</h4>
                <ul class="highlights-list">
                  <li *ngIf="product.organic">Certified organic and pesticide-free</li>
                  <li *ngIf="product.fresh">Freshly harvested and delivered</li>
                  <li>High quality and carefully selected</li>
                  <li>Rich in essential nutrients and vitamins</li>
                  <li>Perfect for healthy lifestyle</li>
                </ul>
              </div>
            </div>
          </div>

          <!-- Reviews -->
          <div class="tab-content reviews-tab">
            <h3 class="tab-title">Customer Reviews</h3>
            <div class="reviews-list" *ngIf="reviews.length > 0; else noReviews">
              <div class="review-item" *ngFor="let r of reviews">
                <div class="review-header">
                  <strong>{{r.userName}}</strong>
                  <span class="review-rating">{{r.rating}}/5</span>
                  <span class="review-date">{{r.createdAt | date:'mediumDate'}}</span>
                </div>
                <div class="review-title" *ngIf="r.title">{{r.title}}</div>
                <div class="review-comment" *ngIf="r.comment">{{r.comment}}</div>
              </div>
            </div>
            <ng-template #noReviews>
              <p>No reviews yet. Be the first to review this product.</p>
            </ng-template>

            <div class="review-form">
              <h4 class="review-title-row">
                <span>Write a review</span>
                <span class="review-subtitle">Share your experience to help others</span>
              </h4>

              <div class="rating-picker" aria-label="Select rating">
                <button type="button"
                        class="star"
                        *ngFor="let idx of [1,2,3,4,5]"
                        [class.active]="idx <= getActiveRating()"
                        (mouseenter)="onStarEnter(idx)"
                        (mouseleave)="onStarLeave()"
                        (click)="setRating(idx)">
                  ★
                </button>
                <span class="rating-value">{{ getActiveRating() }}/5</span>
              </div>

              <div class="review-grid">
                <div class="field">
                  <label>Title</label>
                  <input type="text" [(ngModel)]="reviewForm.title" placeholder="Great quality and fresh!"/>
                </div>
                <div class="field">
                  <label>Comment</label>
                  <textarea rows="4" [(ngModel)]="reviewForm.comment" placeholder="Tell us what you liked or what could be better"></textarea>
                </div>
              </div>

              <div class="review-actions">
                <button class="btn btn-primary" (click)="submitReview()" [disabled]="isSubmittingReview">
                  {{ isSubmittingReview ? 'Submitting...' : 'Submit Review' }}
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Related Products -->
    <div class="related-products" *ngIf="relatedProducts.length > 0">
      <div class="container">
        <div class="section-header">
          <h3 class="section-title">You May Also Like</h3>
          <p class="section-description">Similar products from {{getCategoryDisplayName()}}</p>
        </div>
        
        <div class="related-grid">
          <div 
            *ngFor="let relatedProduct of relatedProducts" 
            class="related-item"
            (click)="navigateToProduct(relatedProduct.id)">
            <div class="related-image">
              <ng-container *ngIf="relatedProduct.image && relatedProduct.image.startsWith('http'); else textRelated">
                <img class="related-img" [src]="relatedProduct.image" [alt]="relatedProduct.name" />
              </ng-container>
              <ng-template #textRelated>
                <span class="related-emoji">{{relatedProduct.image}}</span>
              </ng-template>
            </div>
            <div class="related-info">
              <h4 class="related-title">{{relatedProduct.name}}</h4>
              <div class="related-price">
                <span class="related-current">₹{{relatedProduct.price}}</span>
                <span class="related-original" *ngIf="relatedProduct.originalPrice">₹{{relatedProduct.originalPrice}}</span>
              </div>
              <div class="related-rating">
                <img src="assets/images/icons/star-filled.svg" alt="Rating" class="rating-star">
                <span class="rating-value">{{relatedProduct.rating}}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Lightbox Overlay -->
    <div class="lightbox-overlay" *ngIf="isLightboxOpen" (click)="closeLightbox()">
      <div class="lightbox-content" (click)="$event.stopPropagation()">
        <button class="lightbox-close" (click)="closeLightbox($event)" aria-label="Close image">×</button>
        <img *ngIf="selectedImage && selectedImage.startsWith('http')" [src]="selectedImage" [alt]="product.name" class="lightbox-img" />
        <span *ngIf="!selectedImage || !selectedImage.startsWith('http')" class="lightbox-emoji">{{selectedImage}}</span>
      </div>
    </div>
  </div>
</div>

<!-- Sticky Mobile Action Bar -->
<!-- <div class="mobile-sticky-bar" *ngIf="!isLoading && product">
  <div class="sticky-content">
    <div class="sticky-price">₹{{product.price}} <span class="unit" *ngIf="product.unit">/ {{product.unit}}</span></div>
    <div class="sticky-actions">
      <button class="btn wishlist" (click)="toggleWishlist()">{{ isInWishlist ? 'Wishlisted' : 'Wishlist' }}</button>
      <button class="btn primary" (click)="addToCart()" [disabled]="!product.inStock || isAddingToCart">{{ isAddingToCart ? 'Adding...' : 'Add to Cart' }}</button>
    </div>
  </div>
  <div class="sticky-safe-area"></div>
</div> -->