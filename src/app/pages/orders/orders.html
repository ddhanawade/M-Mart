<div class="orders-page">
  <!-- Page Header -->
  <div class="page-header">
    <div class="container">
      <div class="header-content">
        <div class="breadcrumb">
          <a routerLink="/">Home</a>
          <span class="separator">></span>
          <span class="current">My Orders</span>
        </div>
        <h1 class="page-title">My Orders</h1>
        <p class="page-description">Track and manage your order history</p>
      </div>
    </div>
  </div>

  <div class="orders-content">
    <div class="container">
      <!-- Order Summary Cards -->
      <div class="summary-cards">
        <div class="summary-card">
          <div class="card-icon">
            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M9 5H7C5.89543 5 5 5.89543 5 7V19C5 20.1046 5.89543 21 7 21H17C18.1046 21 19 20.1046 19 19V7C19 5.89543 18.1046 5 17 5H15M9 5C9 3.89543 9.89543 3 11 3H13C14.1046 3 15 3.89543 15 5M9 5V7H15V5M9 12H15M9 16H12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
          <div class="card-content">
            <div class="card-number">{{orderSummary.totalOrders}}</div>
            <div class="card-label">Total Orders</div>
          </div>
        </div>
        <div class="summary-card">
          <div class="card-icon">
            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M12 6V12L16 14M22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
          <div class="card-content">
            <div class="card-number">{{orderSummary.activeOrders}}</div>
            <div class="card-label">Active Orders</div>
          </div>
        </div>
        <div class="summary-card">
          <div class="card-icon">
            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M9 12L11 14L15 10M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
          <div class="card-content">
            <div class="card-number">{{orderSummary.completedOrders}}</div>
            <div class="card-label">Completed</div>
          </div>
        </div>
        <div class="summary-card">
          <div class="card-icon">
            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M12 1V23M17 5H9.5C8.57174 5 7.6815 5.36875 7.02513 6.02513C6.36875 6.6815 6 7.57174 6 8.5C6 9.42826 6.36875 10.3185 7.02513 10.9749C7.6815 11.6312 8.57174 12 9.5 12H14.5C15.4283 12 16.3185 12.3687 16.9749 13.0251C17.6312 13.6815 18 14.5717 18 15.5C18 16.4283 17.6312 17.3185 16.9749 17.9749C16.3185 18.6312 15.4283 19 14.5 19H6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
          <div class="card-content">
            <div class="card-number">₹{{orderSummary.totalSpent}}</div>
            <div class="card-label">Total Spent</div>
          </div>
        </div>
      </div>

      <!-- Filters Section -->
      <div class="filters-section">
        <div class="filters-header">
          <h3>Filter Orders</h3>
          <button class="clear-filters-btn" (click)="clearFilters()" *ngIf="selectedStatus !== 'all' || selectedTimeRange !== 'all' || searchQuery">
            Clear Filters
          </button>
        </div>
        
        <div class="filters-row">
          <!-- Status Filter -->
          <div class="filter-group">
            <label>Status</label>
            <select [(ngModel)]="selectedStatus" (change)="onStatusFilterChange()" class="filter-select">
              <option value="all">All Status</option>
              <option value="pending">Pending</option>
              <option value="confirmed">Confirmed</option>
              <option value="processing">Processing</option>
              <option value="shipped">Shipped</option>
              <option value="delivered">Delivered</option>
              <option value="cancelled">Cancelled</option>
            </select>
          </div>

          <!-- Time Range Filter -->
          <div class="filter-group">
            <label>Time Range</label>
            <select [(ngModel)]="selectedTimeRange" (change)="onTimeRangeChange()" class="filter-select">
              <option value="all">All Time</option>
              <option value="week">Last Week</option>
              <option value="month">Last Month</option>
              <option value="quarter">Last 3 Months</option>
            </select>
          </div>

          <!-- Search -->
          <div class="filter-group search-group">
            <label>Search</label>
            <div class="search-container">
              <input 
                type="text" 
                placeholder="Search by order number, product name..." 
                [(ngModel)]="searchQuery"
                (input)="onSearchChange()"
                class="search-input">
              <div class="search-icon">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M21 21L16.514 16.506L21 21ZM19 10.5C19 15.194 15.194 19 10.5 19C5.806 19 2 15.194 2 10.5C2 5.806 5.806 2 10.5 2C15.194 2 19 5.806 19 10.5Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Orders List -->
      <div class="orders-section">
        <!-- Loading State -->
        <div class="loading-state" *ngIf="isLoading">
          <div class="loading-spinner"></div>
          <p>Loading your orders...</p>
        </div>

        <!-- No Orders State -->
        <div class="no-orders" *ngIf="!isLoading && filteredOrders.length === 0 && orders.length === 0">
          <div class="no-orders-content">
            <div class="no-orders-icon">
              <svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M21 16V8C20.9996 7.64928 20.9071 7.30481 20.7315 7.00116C20.556 6.69751 20.3037 6.44536 20 6.27L13 2.27C12.696 2.09446 12.3511 2.00205 12 2.00205C11.6489 2.00205 11.304 2.09446 11 2.27L4 6.27C3.69626 6.44536 3.44398 6.69751 3.26846 7.00116C3.09294 7.30481 3.00036 7.64928 3 8V16C3.00036 16.3507 3.09294 16.6952 3.26846 16.9988C3.44398 17.3025 3.69626 17.5546 4 17.73L11 21.73C11.304 21.9055 11.6489 21.9979 12 21.9979C12.3511 21.9979 12.696 21.9055 13 21.73L20 17.73C20.3037 17.5546 20.556 17.3025 20.7315 16.9988C20.9071 16.6952 20.9996 16.3507 21 16Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M3.27 6.96L12 12.01L20.73 6.96M12 22.08V12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </div>
            <h3>No Orders Yet</h3>
            <p>You haven't placed any orders yet. Start shopping for fresh products!</p>
            <a routerLink="/products" class="btn btn-primary">
              <span class="btn-icon">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M3 3H5L5.4 5M7 13H17L21 5H5.4M7 13L5.4 5M7 13L4.7 15.3C4.3 15.7 4.6 16.5 5.1 16.5H17M17 13V17C17 18.1 17.9 19 19 19C20.1 19 21 18.1 21 17C21 15.9 20.1 15 19 15C17.9 15 17 15.9 17 17ZM9 19C10.1 19 11 18.1 11 17C11 15.9 10.1 15 9 15C7.9 15 7 15.9 7 17C7 18.1 7.9 19 9 19Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </span>
              Start Shopping
            </a>
          </div>
        </div>

        <!-- No Filtered Results -->
        <div class="no-results" *ngIf="!isLoading && filteredOrders.length === 0 && orders.length > 0">
          <div class="no-results-content">
            <div class="no-results-icon">
              <svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M21 21L16.514 16.506L21 21ZM19 10.5C19 15.194 15.194 19 10.5 19C5.806 19 2 15.194 2 10.5C2 5.806 5.806 2 10.5 2C15.194 2 19 5.806 19 10.5Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </div>
            <h3>No Orders Found</h3>
            <p>No orders match your current filters. Try adjusting your search criteria.</p>
            <button class="btn btn-outline" (click)="clearFilters()">
              Clear Filters
            </button>
          </div>
        </div>

        <!-- Orders Grid -->
        <div class="orders-grid" *ngIf="!isLoading && filteredOrders.length > 0">
          <div class="order-card" *ngFor="let order of filteredOrders; trackBy: trackByOrderId">
            <!-- Order Header -->
            <div class="order-header">
              <div class="order-info">
                <div class="order-number">{{order.orderNumber}}</div>
                <div class="order-date">{{formatDate(order.orderDate)}}</div>
              </div>
              <div class="order-status">
                <span class="status-badge" [ngClass]="getStatusClass(order.status)">
                  <span class="status-icon">{{getStatusIcon(order.status)}}</span>
                  {{order.status | titlecase}}
                </span>
              </div>
            </div>

            <!-- Order Items Preview -->
            <div class="order-items">
              <div class="item-preview" *ngFor="let item of order.items.slice(0, 3)">
                <img [src]="item.productImage" [alt]="item.productName" class="item-image">
                <div class="item-details">
                  <div class="item-name">{{item.productName}}</div>
                  <div class="item-quantity">Qty: {{item.quantity}}</div>
                </div>
              </div>
              <div class="more-items" *ngIf="order.items.length > 3">
                +{{order.items.length - 3}} more items
              </div>
            </div>

            <!-- Order Summary -->
            <div class="order-summary">
              <div class="summary-row">
                <span>Total Amount:</span>
                <span class="amount">₹{{order.total}}</span>
              </div>
              <div class="summary-row">
                <span>Payment:</span>
                <span class="payment-status" [ngClass]="'payment-' + order.paymentStatus">
                  {{getPaymentStatusIcon(order.paymentStatus)}} {{order.paymentStatus | titlecase}}
                </span>
              </div>
              <div class="summary-row" *ngIf="order.estimatedDelivery">
                <span>Expected Delivery:</span>
                <span>{{formatDate(order.estimatedDelivery)}}</span>
              </div>
            </div>

            <!-- Order Actions -->
            <div class="order-actions">
              <button class="btn btn-outline btn-sm" (click)="viewOrderDetails(order)">
                <span class="btn-icon">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M1 12C1 12 5 4 12 4C19 4 23 12 23 12C23 12 19 20 12 20C5 20 1 12 1 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2"/>
                  </svg>
                </span>
                View Details
              </button>
              
              <button class="btn btn-outline btn-sm" 
                      *ngIf="canTrackOrder(order)" 
                      (click)="trackOrder(order)">
                <span class="btn-icon">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 10C21 17 12 23 12 23C12 23 3 17 3 10C3 7.61305 3.94821 5.32387 5.63604 3.63604C7.32387 1.94821 9.61305 1 12 1C14.3869 1 16.6761 1.94821 18.3639 3.63604C20.0518 5.32387 21 7.61305 21 10Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <circle cx="12" cy="10" r="3" stroke="currentColor" stroke-width="2"/>
                  </svg>
                </span>
                Track Order
              </button>
              
              <button class="btn btn-primary btn-sm" (click)="reorder(order)">
                <span class="btn-icon">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M1 4V10H7M23 20V14H17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M20.49 9C19.9828 7.56678 19.1209 6.28392 17.9845 5.27304C16.8482 4.26216 15.4745 3.55682 13.9917 3.22425C12.5089 2.89168 10.9652 2.94348 9.50481 3.37478C8.04437 3.80608 6.72475 4.60054 5.64 5.68L1 10M23 14L18.36 18.32C17.2752 19.3995 15.9556 20.1939 14.4952 20.6252C13.0348 21.0565 11.4911 21.1083 10.0083 20.7758C8.52547 20.4432 7.1518 19.7378 6.01547 18.727C4.87913 17.7161 4.01717 16.4333 3.51 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </span>
                Reorder
              </button>
              
              <button class="btn btn-danger btn-sm" 
                      *ngIf="canCancelOrder(order)" 
                      (click)="initiateCancel(order)">
                <span class="btn-icon">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                    <path d="15 9L9 15M9 9L15 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </span>
                Cancel
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Order Details Modal -->
  <div class="modal-overlay" *ngIf="showOrderDetails" (click)="closeOrderDetails()">
    <div class="modal-content order-details-modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Order Details</h3>
        <button class="close-btn" (click)="closeOrderDetails()">×</button>
      </div>
      
      <div class="modal-body" *ngIf="selectedOrder">
        <!-- Order Info -->
        <div class="order-info-section">
          <div class="info-row">
            <span class="label">Order Number:</span>
            <span class="value">{{selectedOrder.orderNumber}}</span>
          </div>
          <div class="info-row">
            <span class="label">Order Date:</span>
            <span class="value">{{formatDateTime(selectedOrder.orderDate)}}</span>
          </div>
          <div class="info-row">
            <span class="label">Status:</span>
            <span class="value">
              <span class="status-badge" [ngClass]="getStatusClass(selectedOrder.status)">
                {{getStatusIcon(selectedOrder.status)}} {{selectedOrder.status | titlecase}}
              </span>
            </span>
          </div>
          <div class="info-row" *ngIf="selectedOrder.trackingNumber">
            <span class="label">Tracking Number:</span>
            <span class="value">{{selectedOrder.trackingNumber}}</span>
          </div>
        </div>

        <!-- Order Items -->
        <div class="order-items-section">
          <h4>Items Ordered</h4>
          <div class="items-list">
            <div class="item-row" *ngFor="let item of selectedOrder.items">
              <img [src]="item.productImage" [alt]="item.productName" class="item-image">
              <div class="item-details">
                <div class="item-name">{{item.productName}}</div>
                <div class="item-category">{{item.category | titlecase}}</div>
                <div class="item-quantity">Quantity: {{item.quantity}}</div>
              </div>
              <div class="item-price">
                <div class="current-price">₹{{item.price}}</div>
                <div class="total-price">Total: ₹{{item.total}}</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Delivery Address -->
        <div class="address-section">
          <h4>Delivery Address</h4>
          <div class="address-card">
            <div class="address-name">{{selectedOrder.deliveryAddress.name}}</div>
            <div class="address-details">
              {{selectedOrder.deliveryAddress.street}}<br>
              {{selectedOrder.deliveryAddress.city}}, {{selectedOrder.deliveryAddress.state}} - {{selectedOrder.deliveryAddress.pincode}}
              <span *ngIf="selectedOrder.deliveryAddress.landmark"><br>Near {{selectedOrder.deliveryAddress.landmark}}</span>
            </div>
          </div>
        </div>

        <!-- Order Timeline -->
        <div class="timeline-section">
          <h4>Order Timeline</h4>
          <div class="timeline">
            <div class="timeline-item" *ngFor="let event of selectedOrder.timeline">
              <div class="timeline-dot"></div>
              <div class="timeline-content">
                <div class="timeline-message">{{event.message}}</div>
                <div class="timeline-time">{{formatDateTime(event.timestamp)}}</div>
                <div class="timeline-location" *ngIf="event.location">{{event.location}}</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Payment Details -->
        <div class="payment-section">
          <h4>Payment Details</h4>
          <div class="payment-details">
            <div class="payment-row">
              <span>Method:</span>
              <span>{{selectedOrder.payment.method.toUpperCase()}}</span>
            </div>
            <div class="payment-row">
              <span>Transaction ID:</span>
              <span>{{selectedOrder.payment.transactionId}}</span>
            </div>
            <div class="payment-row">
              <span>Status:</span>
              <span class="payment-status" [ngClass]="'payment-' + selectedOrder.payment.status">
                {{getPaymentStatusIcon(selectedOrder.payment.status)}} {{selectedOrder.payment.status | titlecase}}
              </span>
            </div>
          </div>
        </div>

        <!-- Order Total -->
        <div class="total-section">
          <div class="total-row">
            <span>Subtotal:</span>
            <span>₹{{selectedOrder.subtotal}}</span>
          </div>
          <div class="total-row">
            <span>Delivery Charge:</span>
            <span>₹{{selectedOrder.deliveryCharge}}</span>
          </div>
          <div class="total-row" *ngIf="selectedOrder.discount > 0">
            <span>Discount:</span>
            <span class="discount">-₹{{selectedOrder.discount}}</span>
          </div>
          <div class="total-row final-total">
            <span>Total Amount:</span>
            <span>₹{{selectedOrder.total}}</span>
          </div>
        </div>
      </div>
      
      <div class="modal-footer">
        <button class="btn btn-outline" (click)="downloadInvoice(selectedOrder!)">
          <span class="btn-icon">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M14 2H6C5.46957 2 4.96086 2.21071 4.58579 2.58579C4.21071 2.96086 4 3.46957 4 4V20C4 20.5304 4.21071 21.0391 4.58579 21.4142C4.96086 21.7893 5.46957 22 6 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V8L14 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M14 2V8H20M16 13H8M16 17H8M10 9H8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </span>
          Download Invoice
        </button>
        <button class="btn btn-primary" (click)="reorder(selectedOrder!)">
          <span class="btn-icon">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M1 4V10H7M23 20V14H17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M20.49 9C19.9828 7.56678 19.1209 6.28392 17.9845 5.27304C16.8482 4.26216 15.4745 3.55682 13.9917 3.22425C12.5089 2.89168 10.9652 2.94348 9.50481 3.37478C8.04437 3.80608 6.72475 4.60054 5.64 5.68L1 10M23 14L18.36 18.32C17.2752 19.3995 15.9556 20.1939 14.4952 20.6252C13.0348 21.0565 11.4911 21.1083 10.0083 20.7758C8.52547 20.4432 7.1518 19.7378 6.01547 18.727C4.87913 17.7161 4.01717 16.4333 3.51 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </span>
          Reorder Items
        </button>
      </div>
    </div>
  </div>

  <!-- Cancel Order Modal -->
  <div class="modal-overlay" *ngIf="showCancelDialog" (click)="closeCancelDialog()">
    <div class="modal-content cancel-modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Cancel Order</h3>
        <button class="close-btn" (click)="closeCancelDialog()">×</button>
      </div>
      
      <div class="modal-body">
        <p>Are you sure you want to cancel this order?</p>
        <div class="cancel-reason">
          <label for="cancelReason">Reason for cancellation (optional):</label>
          <textarea 
            id="cancelReason"
            [(ngModel)]="cancelReason" 
            placeholder="Please let us know why you're cancelling..."
            rows="3"
            class="reason-textarea">
          </textarea>
        </div>
      </div>
      
      <div class="modal-footer">
        <button class="btn btn-outline" (click)="closeCancelDialog()">
          Keep Order
        </button>
        <button class="btn btn-danger" (click)="cancelOrder()">
          Cancel Order
        </button>
      </div>
    </div>
  </div>
</div> 